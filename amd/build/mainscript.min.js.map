{"version":3,"file":"mainscript.min.js","sources":["../src/mainscript.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manager for the accessreview block.\n *\n * @module      block_cinfo/mainscript\n * @author      Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @copyright   2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Fragment from 'core/fragment';\nimport ModalFactory from 'core/modal_factory';\n\nexport const init = () => {\n    if ($(\"body.path-course-view div.course-content\").length > 0) {\n        $('body').addClass('has-cinfo');\n        var array = $(\"#modarray\").data(\"modarray\");\n        const tools = `<span id=\"cinfo-toolbar\" class=\"d-block position-sticky\">${$(\"#cinfo-wrapper\").html()}</span>`;\n        $(tools).insertBefore(\"div.course-content\");\n        if ($(\"#cinfo-toolbar #toolbar\").hasClass(\"m41\")) {\n            $(\"#cinfo-toolbar\").css(\"top\", \"0\");\n        }\n\n        $(\".block_cinfo #cinfo-wrapper\").remove();\n\n        $(document).on(\"click\", \"#btn-search\", function() {\n            $(\"#cinfo-block-search\").toggleClass(\"d-none d-block\");\n            $(\"#cinfo-block-search input\").focus();\n            $(\"#cinfo-block-search input\").val(\"\");\n            $(\"#cinfo-block-search .input-group\").toggleClass(\"w-100\");\n            $(\"#searchresults\").html(\"\");\n            $(\"#toolbar\").css(\"opacity\", \"0\");\n        });\n\n        $(document).on(\"click\", \"#cinfo-block-search .input-group-append.search-close\", function() {\n            $(\"#cinfo-block-search input\").val(\"\");\n            $(\"#cinfo-block-search\").toggleClass(\"d-none d-block\");\n            $(\"#cinfo-block-search .input-group\").toggleClass(\"w-100\");\n            $(\"#searchresults\").html(\"\");\n            $(\"#toolbar\").css(\"opacity\", \"1\");\n        });\n\n        $(document).on(\"input\", \"#cinfo-block-search input\", function() {\n            // Search through the array \"name\" and render the results.\n            var searchTerm = $(this).val().toLowerCase();\n            if (searchTerm.length > 0) {\n                var searchResults = array.filter(function(item) {\n                    return item.name.toLowerCase().indexOf(searchTerm) > -1;\n                });\n                var searchResultsHTML = \"\";\n                if (searchResults.length > 0) {\n                    searchResults.forEach(function(item, index) {\n                        searchResultsHTML += `<a class=\"list-group-item py-1  ${index == 0 ? \"active\" : \"\"}\"\n            href=\"${item.url}\">${item.icon}${item.name}</a>`;\n                    });\n                } else {\n                    $(\"#searchresults\").html(\"\");\n                }\n                $(\"#searchresults\").html(searchResultsHTML);\n            } else {\n                $(\"#searchresults\").html(\"\");\n            }\n        });\n\n        $(document).on(\"click\", \"#searchresults a.list-group-item\", function() {\n            // Close the search results when the user clicks on a result.\n            $(\"#cinfo-block-search .input-group-append\").trigger(\"click\");\n            if ($(this).attr(\"href\").includes(\"#module-\")) {\n                window.console.log(true);\n                let $this = $(this);\n                setTimeout(function() {\n                    // Add class active.\n                    $(`li.activity${$this.attr(\"href\")}`).addClass(\"active\");\n\n                    // Remove active class after 1 second.\n                    setTimeout(function() {\n                        $(`li.activity${$this.attr(\"href\")}`).removeClass(\"active\");\n                    }, 2000);\n                }, 1000);\n            }\n        });\n\n        $(document).on(\"keydown\", \"#cinfo-block-search input\", function(e) {\n            // Close the search results when the user presses the escape key.\n            if (e.keyCode === 27) {\n                e.preventDefault();\n                $(\"#cinfo-block-search .input-group-append\").trigger(\"click\");\n            }\n            var current = $(\"#searchresults a.list-group-item.active\");\n            // Navigate through the search results using the arrow keys.\n            if (e.keyCode === 40) {\n                e.preventDefault();\n                var next = current.next();\n                if (next.length > 0) {\n                    current.removeClass(\"active\");\n                    next.addClass(\"active\");\n                }\n            }\n            if (e.keyCode === 38) {\n                e.preventDefault();\n                var prev = current.prev();\n                if (prev.length > 0) {\n                    current.removeClass(\"active\");\n                    prev.addClass(\"active\");\n                }\n            }\n            // Open the selected search result when the user presses the enter key.\n            if (e.keyCode === 13) {\n                e.preventDefault();\n                if (current.length > 0) {\n                    window.location.href = current.attr(\"href\");\n                }\n            }\n        });\n\n        // Handle scrollbuttons.\n        const canScrollRight = () => {\n            const toolbar = document.querySelector(\"#cinfo-toolbar .scrollbar-0\");\n            return toolbar.scrollWidth - toolbar.scrollLeft - 1 > toolbar.clientWidth;\n        };\n\n        const canScrollLeft = () => {\n            const toolbar = document.querySelector(\"#cinfo-toolbar .scrollbar-0\");\n            return toolbar.scrollLeft > 0;\n        };\n\n        const checkScroll = () => {\n            if (canScrollLeft()) {\n                $(\"#scroll-left\").removeClass(\"d-none\");\n            } else {\n                $(\"#scroll-left\").addClass(\"d-none\");\n            }\n\n            if (canScrollRight()) {\n                $(\"#scroll-right\").removeClass(\"d-none\");\n            } else {\n                $(\"#scroll-right\").addClass(\"d-none\");\n            }\n        };\n\n        checkScroll();\n\n        $(document).on(\"click\", \"#scroll-right\", function() {\n            const toolbar = document.querySelector(\"#cinfo-toolbar .scrollbar-0\");\n            toolbar.scrollBy({left: toolbar.clientWidth, behavior: 'smooth'});\n            setTimeout(checkScroll, 500);\n        });\n\n        $(document).on(\"click\", \"#scroll-left\", function() {\n            const toolbar = document.querySelector(\"#cinfo-toolbar .scrollbar-0\");\n            toolbar.scrollBy({left: -toolbar.clientWidth, behavior: 'smooth'});\n            setTimeout(checkScroll, 500);\n        });\n\n        // On resize, check if the scroll buttons are needed.\n        $(window).on('resize', checkScroll);\n\n        // Handle course intro modal\n        $(document).on(\"click\", \"#btn-courseinfo\", function() {\n            const contextid = $(this).data(\"contextid\");\n            ModalFactory.create({\n                title: $(\"#courseinfo-title\").html(),\n                body: Fragment.loadFragment(\"block_cinfo\", \"course_intro\", contextid,\n                    {contextid: contextid, parentcontextid: M.cfg.contextid}),\n                large: true,\n                show: false,\n                removeOnClose: true,\n                isVerticallyCentered: true,\n            }).then(modal => {\n                modal.show();\n                return;\n            }).fail(() => {\n                return;\n            });\n        });\n    }\n};\n\n"],"names":["length","addClass","array","data","tools","html","insertBefore","hasClass","css","remove","document","on","toggleClass","focus","val","searchTerm","this","toLowerCase","searchResults","filter","item","name","indexOf","searchResultsHTML","forEach","index","url","icon","trigger","attr","includes","window","console","log","$this","setTimeout","removeClass","e","keyCode","preventDefault","current","next","prev","location","href","canScrollRight","toolbar","querySelector","scrollWidth","scrollLeft","clientWidth","canScrollLeft","checkScroll","scrollBy","left","behavior","contextid","create","title","body","Fragment","loadFragment","parentcontextid","M","cfg","large","show","removeOnClose","isVerticallyCentered","then","modal","fail"],"mappings":"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"}